!function e(t,n,i){function o(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return o(n?n:e)},u,u.exports,e,t,n,i)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=0;n.D_EAST=i;var o=1;n.D_SOUTH=o;var r=2;n.D_WEST=r;var a=3;n.D_NORTH=a;var s=4;n.D_OTHER=s;var c=2;n.D_OP_MASK=c;var u=0;n.BT_EMPTY=u;var f=1;n.BT_SNAKE=f},{}],2:[function(e,t,n){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e){console.log(e);for(var t=0;null!=e[t];)t++;return t}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=e("./consts.js"),c=i(s),u=function(){function e(t){if(o(this,e),1!=t.version)throw"wrong version";this.json=t;var n=this.json.snakes.filter(function(e){return null!=e}).length;this.cache={nsnake:n}}return a(e,[{key:"handleCommand",value:function(e){try{f[e[0]](e[1],this)}catch(t){console.err(t)}}},{key:"getBox",value:function(e){var t=e.x,n=e.y;return this.json.grid[n*this.json.width+t]}},{key:"getSnakeSize",value:function(){return this.cache.nsnake}},{key:"setSnake",value:function(e){null!=this.json.snakes[e.index]&&this.cache.nsnake--,null!=e&&this.cache.nsnake++,this.json.snakes[e.index]=e}}]),e}();n["default"]=u;var f={move:function(e,t){var n=t.json,i=n.snakes[e.s],o=(i.head,t.getBox(i.head));if(o[1].h!=D_OTHER){var r=applyDirection(i.head,head.d.h),a=t.getBox(r);switch(a.t){case BT_FOOD:i.remain+=a.d.q,a.t=BT_EMPTY,a.d={};case BT_EMPTY:a.t=BT_SNAKE,a.d={d:i.d,s:i.index},i.remain>0&&i.remain--;break;case BT_BLOCK:case BT_SNAKE:for(a=t.getBox(sanke);a.t==BT_SNAKE&&a.d.s==i.index;){var s=applyDirection({x:c,y:u},a.d.d^D_OP_MASK),c=s.x,u=s.y,f=t.getBox({x:c,y:u});a.t=BT_EMPTY,a.d={},a=f}}}},join:function(e,t){var n=e.x,i=e.y,o=t.getBox({x:n,y:i});if(o[0]!=c.BT_EMPTY)throw"box taken";var a=r(t.json.snakes),s={age:0,index:a,head:{x:n,y:i},length:1,name:e.name,remain:e.remain,tail:{x:n,y:i}};t.setSnake(s),t.json.snakes[s.index]=s,o[0]=c.BT_SNAKE,o[1]={h:c.D_OTHER,s:s.index,t:c.D_OTHER_T}}};t.exports=n["default"]},{"./consts.js":1}],3:[function(e,t,n){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./consts.js"),r=i(o);n["default"]=function(e){for(var t=e.width*e.height,n=[],i=0;t>i;i++)n[i]=[r.BT_EMPTY,{}];var o={version:1,width:e.width,height:e.height,grid:n,snakes:[]};return{game:o}},t.exports=n["default"]},{"./consts.js":1}],4:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}var r=e("../consts.js"),a=o(r),s=e("../map.js"),c=i(s),u=e("../game.js"),f=i(u);describe("Sample test",function(){describe("basics",function(){it("is working",function(){expect(!0).to.equal(!0)}),it("can import",function(){expect(a.D_EAST).to.be(0)})}),describe("hooks",function(){var e=0;before(function(){e+=1}),it("run before block",function(){expect(e).to.be(1)}),it("run before block twice",function(){expect(e).to.be(1)})})}),describe("map",function(){var e;beforeEach(function(){e={version:1,width:10,height:10}}),describe.skip("validation",function(){it("passes when input is good",function(){expect(c["default"]).withArgs(e).not.to.throwException()}),it("varifies version",function(){e.version=-1,expect(c["default"]).withArgs(e).to.throwException()}),it.skip("varifies size",function(){e.width=0,expect(c["default"]).withArgs(e).to.throwException(),e.width=-1,expect(c["default"]).withArgs(e).to.throwException(),e.width=3.5,expect(c["default"]).withArgs(e).to.throwException(),e.width=1e10,expect(c["default"]).withArgs(e).to.throwException(),e.width=10,e.height=0,expect(c["default"]).withArgs(e).to.throwException(),e.height=-1,expect(c["default"]).withArgs(e).to.throwException(),e.height=3.5,expect(c["default"]).withArgs(e).to.throwException(),e.height=1e10,expect(c["default"]).withArgs(e).to.throwException()})}),describe("game",function(){})}),describe("Game",function(){var e,t={j22:["join",{name:"j22",remain:0,x:2,y:2}],j24:["join",{name:"j24",remain:0,x:2,y:4}]};beforeEach(function(){var t={width:20,height:20,version:1};e=new f["default"](c["default"](t).game)}),describe("#handleCommand",function(){describe("join",function(){it("can join many snakes",function(){var n=e.getBox({x:2,y:2}),i=e.getBox({x:2,y:4});e.handleCommand(t.j22),expect(e.getSnakeSize()).to.be(1),expect(n[0]===a.BT_SNAKE),e.handleCommand(t.j24),expect(e.getSnakeSize()).to.be(2),expect(i[0]===a.BT_SNAKE)}),it("cannot add snake at the same position",function(){e.handleCommand(t.j22),e.handleCommand(t.j22),expect(e.getSnakeSize()).to.be(1)})}),describe.skip("move",function(){it("moves along direction",function(){})})})})},{"../consts.js":1,"../game.js":2,"../map.js":3}]},{},[4]);
//# sourceMappingURL=main.min.js.map